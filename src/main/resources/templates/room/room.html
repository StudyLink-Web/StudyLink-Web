<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">

<div layout:fragment="content" style="overflow: hidden;">
	<div class="d-flex flex-column w-100 h-100">
		<div class="d-flex w-100" style="height:100px; border-bottom: 1px solid #ddd;">
			<div class="d-flex flex-row-1 w-100" style="height:100px; overflow-x:auto; overflow-y-hidden;">
				<div id="cleanDiv">
					<div id="cleanBtn" class="btn">
						<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-file" viewBox="0 0 16 16">
							<path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
						</svg>
					</div>
					<p>Clean</p>
				</div>
				<div id="selectionDiv">
					<div id="selectionBtn" class="btn">
						<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-plus-square-dotted" viewBox="0 0 16 16">
							<path d="M2.5 0q-.25 0-.487.048l.194.98A1.5 1.5 0 0 1 2.5 1h.458V0zm2.292 0h-.917v1h.917zm1.833 0h-.917v1h.917zm1.833 0h-.916v1h.916zm1.834 0h-.917v1h.917zm1.833 0h-.917v1h.917zM13.5 0h-.458v1h.458q.151 0 .293.029l.194-.981A2.5 2.5 0 0 0 13.5 0m2.079 1.11a2.5 2.5 0 0 0-.69-.689l-.556.831q.248.167.415.415l.83-.556zM1.11.421a2.5 2.5 0 0 0-.689.69l.831.556c.11-.164.251-.305.415-.415zM16 2.5q0-.25-.048-.487l-.98.194q.027.141.028.293v.458h1zM.048 2.013A2.5 2.5 0 0 0 0 2.5v.458h1V2.5q0-.151.029-.293zM0 3.875v.917h1v-.917zm16 .917v-.917h-1v.917zM0 5.708v.917h1v-.917zm16 .917v-.917h-1v.917zM0 7.542v.916h1v-.916zm15 .916h1v-.916h-1zM0 9.375v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .916v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .917v.458q0 .25.048.487l.98-.194A1.5 1.5 0 0 1 1 13.5v-.458zm16 .458v-.458h-1v.458q0 .151-.029.293l.981.194Q16 13.75 16 13.5M.421 14.89c.183.272.417.506.69.689l.556-.831a1.5 1.5 0 0 1-.415-.415zm14.469.689c.272-.183.506-.417.689-.69l-.831-.556c-.11.164-.251.305-.415.415l.556.83zm-12.877.373Q2.25 16 2.5 16h.458v-1H2.5q-.151 0-.293-.029zM13.5 16q.25 0 .487-.048l-.194-.98A1.5 1.5 0 0 1 13.5 15h-.458v1zm-9.625 0h.917v-1h-.917zm1.833 0h.917v-1h-.917zm1.834-1v1h.916v-1zm1.833 1h.917v-1h-.917zm1.833 0h.917v-1h-.917zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/>
						</svg>
					</div>
					<p>Selection</p>
				</div>
				<div id="toolsDiv">
					<div>
						<div id="penBtn" class="btn">
							<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-vector-pen" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M10.646.646a.5.5 0 0 1 .708 0l4 4a.5.5 0 0 1 0 .708l-1.902 1.902-.829 3.313a1.5 1.5 0 0 1-1.024 1.073L1.254 14.746 4.358 4.4A1.5 1.5 0 0 1 5.43 3.377l3.313-.828zm-1.8 2.908-3.173.793a.5.5 0 0 0-.358.342l-2.57 8.565 8.567-2.57a.5.5 0 0 0 .34-.357l.794-3.174-3.6-3.6z"/>
								<path fill-rule="evenodd" d="M2.832 13.228 8 9a1 1 0 1 0-1-1l-4.228 5.168-.026.086z"/>
							</svg>
						</div>
						<div id="eraseBtn" class="btn">
							<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-eraser" viewBox="0 0 16 16">
								<path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"/>
							</svg>
						</div>
					</div>
					<p>Tools</p>
				</div>
				<div id="historyDiv">
					<div>
						<div id="undoBtn" class="btn">
							<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
							</svg>
						</div>
						<div id="redoBtn" class="btn">
							<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
							</svg>
						</div>
					</div>
					<p>History</p>
				</div>
				<div id="colorDiv">
					<div class="color-wrap">
						<div class="color-palette">
							<!-- 1줄 -->
							<span class="color-box" data-color="#000000" style="background:#000000"></span>
							<span class="color-box" data-color="#7f7f7f" style="background:#7f7f7f"></span>
							<span class="color-box" data-color="#ffffff" style="background:#ffffff; border:1px solid #ccc"></span>
							<span class="color-box" data-color="#ff0000" style="background:#ff0000"></span>
							<span class="color-box" data-color="#ff7f00" style="background:#ff7f00"></span>
							<span class="color-box" data-color="#ffff00" style="background:#ffff00"></span>
							<span class="color-box" data-color="#00ff00" style="background:#00ff00"></span>
							<span class="color-box" data-color="#00ffff" style="background:#00ffff"></span>
							<span class="color-box" data-color="#0000ff" style="background:#0000ff"></span>
							<span class="color-box" data-color="#8b00ff" style="background:#8b00ff"></span>

							<!-- 2줄 -->
							<span class="color-box" data-color="#4b0000" style="background:#4b0000"></span>
							<span class="color-box" data-color="#8b0000" style="background:#8b0000"></span>
							<span class="color-box" data-color="#ff69b4" style="background:#ff69b4"></span>
							<span class="color-box" data-color="#ffa07a" style="background:#ffa07a"></span>
							<span class="color-box" data-color="#ffd700" style="background:#ffd700"></span>
							<span class="color-box" data-color="#32cd32" style="background:#32cd32"></span>
							<span class="color-box" data-color="#2e8b57" style="background:#2e8b57"></span>
							<span class="color-box" data-color="#20b2aa" style="background:#20b2aa"></span>
							<span class="color-box" data-color="#4169e1" style="background:#4169e1"></span>
							<span class="color-box" data-color="#2f4f4f" style="background:#2f4f4f"></span>
						</div>

						<input type="color" id="customColor" value="#000000">
					</div>
					<p>Color</p>
				</div>
				<div id="shapeDiv">
					<div class="shape-grid">
						<div class="icon rect">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-square" viewBox="0 0 16 16">
								<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
							</svg>
						</div>
						<div class="icon circle">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle" viewBox="0 0 16 16">
								<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
							</svg>
						</div>
						<div class="icon triangle">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-triangle" viewBox="0 0 16 16">
								<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
							</svg>
						</div>
						<div class="icon line">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-slash-lg" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0"/>
							</svg>
						</div>
					</div>
					<p>Shapes</p>
				</div>
				<div id="functionDiv">
					<div class="function-toolbar">
						<!-- 1줄: 함수 입력 + Draw 버튼 -->
						<div class="func-row">
							<div class="func-input">
								<span>y =</span>
								<input type="text" id="funcInput">
							</div>
							<button id="drawBtn">생성</button>
							<button id="funcHelpBtn" type="button">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-square" viewBox="0 0 16 16">
									<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
									<path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
								</svg>
							</button>
						</div>

						<!-- 2줄: x, y 범위 + 축 체크 -->
						<div class="range-row">
							<!-- x 범위 -->
							<div class="x-range">
								<span>x :</span>
								<input type="text" id="xRangeLeft">
								<span>~</span>
								<input type="text" id="xRangeRight">
							</div>

							<!-- y 범위 -->
							<div class="y-range">
								<span>y :</span>
								<input type="text" id="yRangeLeft">
								<span>~</span>
								<input type="text" id="yRangeRight">
							</div>

							<!-- 축 표시 여부 -->
							<div class="axis-toggle">
								<input type="checkbox" id="showAxes" checked>
								<label for="showAxes">x, y축 표시</label>
							</div>
						</div>
					</div>
					<p>Function</p>
				</div>
			</div>
			<div class="d-flex flex-column flex-shrink-0">
				<div id="timerDiv" class="d-flex justify-content-center align-items-center" style="width: 400px; height: 50px; font-size: 1.5rem; background-color: #f0f0f0;">
					<span id="timerDisplay">00:00</span>
				</div>
				<div class="d-flex" style="width: 400px; height: 50px;">
					<button id="registerBtn" class="w-50 h-100">등록</button>
					<button id="exitBtn" class="w-50 h-100"><a href="/room/list">나가기</a></button>
				</div>
			</div>
		</div>

		<div class="d-flex w-100 flex-grow-1 overflow-hidden" style="height: calc(100vh - 100px);">
			<div class="flex-grow-1">
				<canvas id="canvas" class="flex-grow-1 d-flex w-100 h-100"></canvas>
			</div>
			<div class="d-flex flex-column flex-shrink-0" style="width: 400px; border-left: 1px solid #ddd;">
				<div class="flex-grow-1 overflow-auto" id="messageArea"></div>
				<div id="previewContainer"></div>
				<div id="inputDiv">
					<textarea name="message" class="form-control mt-auto" style="height: 120px; border: none" disabled></textarea>
					<input type="file" class="form-control mb-2" name="files" id="file" style="display: none;" multiple disabled/>
					<label for="file" id="fileBtn" class="file-button">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16" >
							<path
									d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.354 9.854a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 8.707V12.5a.5.5 0 0 1-1 0V8.707z"
									fill="white"
									stroke="black"
									stroke-width="0.5"
							/>
						</svg>
					</label>
				</div>
			</div>
		</div>
	</div>

	<div id="funcHelpModal" class="help-modal hidden">
		<div class="help-box">
			<div class="d-flex justify-content-between align-items-center">
				<h4 class="mb-0">함수 입력 안내</h4>
				<button id="closeHelp" style="border:none;background:none;font-size:18px;line-height:1;">×</button>
			</div>
			<ul>
				<li> - <b>x</b> 하나의 변수만 사용 가능합니다.</li>
				<li> - <b>x, y</b> 의 범위는 -20 이상 20 이하입니다.</li>
				<li> - <code>^</code> 는 제곱을 의미합니다. (예: <code>x^2</code>)</li>
				<li> - <code>2x</code> 형태는 자동으로 <code>2*x</code>로 처리됩니다.</li>
			</ul>

			<p><b>사용 가능한 함수</b></p>
			<ul>
				<li> - 삼각함수: <code>sin(x), cos(x), tan(x)</code></li>
				<li> - 역삼각함수: <code>asin(x), acos(x), atan(x)</code></li>
				<li> - 기타: <code>log(x), sqrt(x), abs(x), exp(x)</code></li>
			</ul>

			<p><b>예시</b></p>
			<pre>
x^2
sin(2x)
sqrt(x^2 + 1)
exp(-x)
abs(cos(x))
			</pre>
		</div>
	</div>

	<!-- 등록 모달 -->
	<div id="myModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div class="modal-content" style="
        background-color:#fff;
        margin:100px auto;
        padding:25px 20px;
        border-radius:10px;
        width:500px;        /* 기본 너비 */
        max-width:95%;      /* 화면 최대 너비 */
        height: 340px;
        box-sizing:border-box;
    ">
			<span class="close" id="closeModalBtn" style="cursor:pointer; font-size:24px;">&times;</span>
			<form id="registerForm" action="/room/register" method="post" style="width:100%; box-sizing:border-box;">

				<!-- 과목 영역 -->
				<h3 style="margin-top:0;">과목 선택</h3>
				<div id="subjectDiv" style="width:100%; box-sizing:border-box;"></div>

				<!-- 멘토 배정 -->
				<label style="display:block; margin-top:10px;">
					<input type="checkbox" id="assignMentorCheckbox">
					멘토 배정
				</label>
				<select id="mentorSelect" name="mentorId" disabled style="width:100%; margin-top:5px;"></select>

				<!-- 포인트 -->
				<div style="margin-top:10px;">보유 포인트 : [[${userPoint}]]P</div>
				<div id="pointDiv" style="width:100%; box-sizing:border-box; margin-top:5px;"></div>

				<!-- 버튼 -->
				<div id="btnDiv" class="btnDiv" style="margin-top:15px; text-align:right;"></div>

				<input type="hidden" name="roomId" th:value="${roomDTO.roomId}">
			</form>
		</div>
	</div>

	<!-- 종료 모달 -->
	<div id="endModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div class="modal-content" style="
        background-color:#fff;
        margin:100px auto;
        padding:25px 20px;
        border-radius:10px;
        width:500px;
        max-width:95%;
        height: 340px;
        box-sizing:border-box;
    ">
			<span class="close" id="closeEndModalBtn" style="cursor:pointer; font-size:24px;">&times;</span>
			<form id="endForm" action="/room/endRoom" method="post" style="width:100%; box-sizing:border-box;">
				<h3>답변 만족도</h3>
				<div class="star-rating" style="display:flex; gap:5px; margin-bottom:10px;">
					<span data-value="1">&#9733;</span>
					<span data-value="2">&#9733;</span>
					<span data-value="3">&#9733;</span>
					<span data-value="4">&#9733;</span>
					<span data-value="5">&#9733;</span>
				</div>
				<input type="hidden" name="rating" id="ratingValue" value="0">
				<div class="favoriteDiv">
					<label style="display:block; margin-bottom:10px;">
						<input type="checkbox" id="addFavoriteMentorCheckbox" name="addFavoriteMentorCheckbox">
						멘토 찜하기
					</label>
					<span id="favoriteMessage" style="display:none; color:red; margin-bottom:10px;">이미 찜한 멘토입니다.</span>
				</div>

				<!-- 안내 메시지 영역 -->
				<div class="favoriteNotice">
					· 찜한 멘토에게 1:1 문제를 직접 등록할 수 있습니다.<br />
					· 멘토의 활동시간에만 1:1등록이 가능합니다.<br />
					· 멘토의 답변가능 과목만 질문할 수 있습니다.
				</div>


				<input type="hidden" name="roomId" th:value="${roomDTO.roomId}">
				<div id="endModalBtnDiv" class="btnDiv" style="text-align:right;"></div>
			</form>
		</div>
	</div>
	<script th:inline="javascript">
        // 서버에서 넘어온 데이터를 JS 변수로 변환
        let subjectList = [[${subjectList}]];
        let favoriteList = [[${favoriteList}]];
        let userPoint = [[${userPoint}]];
        let roomDTO = [[${roomDTO}]];
        let senderId = [[${senderId}]];
        let userRoles = [[${#authentication.authorities}]];
        let message = [[${message}]] // redirect시 담겨오는 메시지
		let timeLeft = [[${timeLeft != null} ? ${timeLeft} : 0]];
	</script>
	<script src="/js/room.js"></script>
	<script src="/js/roomRegister.js"></script>
</div>

