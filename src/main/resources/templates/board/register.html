<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<body>
<div layout:fragment="content" class="content_box">
    <h1>대학생활 등록하기</h1>

    <form th:action="@{/board/register}" method="post" enctype="multipart/form-data">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="mb-3">
            <label for="title" class="form-label">제목</label>
            <input type="text" name="title" class="form-control" id="title"
                   placeholder="제목을 입력하세요." required>
        </div>

        <div class="mb-3">
            <label for="writer" class="form-label">작성자</label>
            <input type="text" name="writer" class="form-control" id="writer"
                   th:value="${#authentication != null ? #authentication.name : ''}"
                   readonly>
        </div>

        <div class="mb-3">
            <label for="department" class="form-label">학과</label>
            <input type="text" name="department" class="form-control" id="department"
                   placeholder="학과를 입력하세요.">
        </div>

        <div class="mb-3">
            <label for="content" class="form-label">내용</label>
            <textarea class="form-control" name="content" id="content" rows="5"
                      placeholder="내용을 입력하세요." required></textarea>
        </div>

        <div class="mb-3">
            <input type="file" name="files" class="form-control" id="file" multiple style="display:none">
            <button type="button" class="btn btn-outline-dark" id="trigger">file upload</button>
        </div>

        <div class="mb-3" id="fileZone"></div>

        <button type="submit" class="btn btn-primary" id="regBtn">register</button>
        <a th:href="@{/board/list}" class="btn btn-secondary">cancel</a>
    </form>

    <script th:inline="javascript">
        window.IS_LOGIN = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
        window.USER_EMAIL = /*[[${#authentication != null ? #authentication.principal.email : null}]]*/ null;
        window.ALLOW_REGISTER = window.IS_LOGIN === true && String(window.USER_EMAIL ?? '').trim().toLowerCase() === 'jeong36023610@gmail.com';

        if (!window.ALLOW_REGISTER) {
          alert('권한이 없습니다.');
          location.replace('/board/list');
        }
    </script>

    <script th:src="@{/js/board.js}"></script>
</div>
</body>
</html>
