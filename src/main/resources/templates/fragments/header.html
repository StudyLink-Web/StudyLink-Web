<header th:fragment="header"
		class="site-header"
		xmlns:th="http://www.thymeleaf.org"
		xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

	<link rel="stylesheet" th:href="@{/css/header-style.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">

	<div class="header">
		<div class="header-inner">

			<!-- 로고 -->
			<a href="/" class="logo">🎓 StudyLink</a>

			<!-- ⭐ 변경: sec:authorize → th:if + sec:authorize -->
			<!-- 로그인 전 -->
			<ul class="header-nav" th:if="${#authorization.expression('isAnonymous()')}">
				<li>
					<a th:href="@{/room/list}" class="header-nav-link">문제 리스트</a>
				</li>
				<li>
					<a th:href="@{/chatbot}" class="header-nav-link">AI 대입 상담</a>
				</li>
				<li>
					<a th:href="@{/board/list}" class="header-nav-link">대학생활 게시판</a>
				</li>
				<li>
					<a th:href="@{/login}" class="header-nav-link">로그인</a>
				</li>
				<li>
					<a th:href="@{/signup}" class="header-nav-link">회원가입</a>
				</li>
			</ul>

			<!-- 로그인 후 -->
			<ul class="header-nav" th:if="${#authorization.expression('isAuthenticated()')}">
				<li>
					<a th:href="@{/room/list}" class="header-nav-link">문제 리스트</a>
				</li>
				<li>
					<a th:href="@{/chatbot}" class="header-nav-link">AI 대입 상담</a>
				</li>
				<li>
					<a th:href="@{/board/list}" class="header-nav-link">대학생활 게시판</a>
				</li>
				<li><a th:href="@{/dashboard}" class="header-nav-link">대시보드</a></li>

				<li class="dropdown">
					<a href="#"
					   class="header-nav-link dropdown-toggle"
					   id="userDropdown"
					   role="button"
					   data-toggle="dropdown"
					   aria-expanded="false"
					   style="cursor: pointer;" >

						<!-- 👤 <span th:text="${#authentication.principal.attributes['name']}"></span> --->
						<!-- 👤 <span th:text="${#authentication.name}"></span> -->

						<!-- OAuth2 로그인(Google/Kakao/Naver)에서는 name, 로컬 폼 로그인에서는 username 사용 -->
						<!--
						<span th:with="userName=${
							#authentication.principal.attributes != null && #authentication.principal.attributes['name'] != null
								? #authentication.principal.attributes['name']
								: #authentication.name
						}" th:text="${userName}">
						</span>
						-->

						<!-- 이름 (소셜 로그인 패치 완료) -->
						<!--
						👤 <span th:text="${
							   #authentication.principal instanceof T(org.springframework.security.oauth2.core.user.DefaultOAuth2User)
								 ? #authentication.principal.attributes['name']
								 : #authentication.name
							}">
							</span>
						-->

						<!-- 이름 + ROLE -->
						<!--
						👤 <span th:text="${
						   #authentication.principal instanceof T(org.springframework.security.oauth2.core.user.DefaultOAuth2User)
							? #authentication.principal.attributes['name'] + ' [' + #authentication.principal.attributes.get('role') + ']'
							: #authentication.name + ' [' + #authentication.principal.authorities[0].authority.substring(5) + ']'
						}">
						</span>
						-->

						<!-- 사용자 정보 표시
						<span th:text="|${userName} [${userRole}]|"></span>

						<p th:text="'DEBUG userName = ' + ${userName}"></p>
						<p th:text="'DEBUG userRole = ' + ${userRole}"></p>
						-->


						<span th:if="${userName != null}"
							  th:text="|${userName} [${userRole}]|"></span>

						<span th:if="${userName == null}">
							Guest [GUEST]
						</span>

					</a>

					<ul class="dropdown-menu dropdown-menu-right">
						<li><a class="dropdown-item" href="/mentor/edit-profile">멘토 프로필</a></li>
						<li><a class="dropdown-item" href="/auth/student-verification">멘토 인증</a></li>
						<li><a class="dropdown-item" href="/my-page"> 환경설정 </a></li>
						<li><hr class="dropdown-divider"></li>
						<li>
							<form method="post" th:action="@{/logout}" style="display: inline; width: 100%;">
								<button type="submit" class="dropdown-item" style="background: none; border: none; cursor: pointer; text-align: left; width: 100%; padding: 10px 16px;">
									로그아웃
								</button>
							</form>
						</li>
					</ul>
				</li>

				<!-- 환전 페이지 이동(임시) -->
				<a href="/payment/payment">결제하기</a>
				<a href="/payment/exchange">환전하기</a>
			</ul>



			<!-- 알림 및 테마 도구 -->
			<div class="header-tools">
				<!-- 테마 토글 (모든 유저) -->
				<button id="themeToggle" class="tool-btn" title="테마 변경">
					<span class="theme-icon sun-icon">☀️</span>
					<span class="theme-icon moon-icon" style="display: none;">🌙</span>
				</button>

				<!-- 알림 (로그인 유저만) -->
				<div class="notification-wrapper" sec:authorize="isAuthenticated()">
					<button id="notiBell" class="tool-btn" title="알림 확인">
						<span class="bell-icon">🔔</span>
						<span id="notiBadge" class="noti-badge" style="display: none;">0</span>
					</button>
					
					<!-- 알림 드롭다운 패널 -->
					<div id="notiPanel" class="noti-panel">
						<div class="noti-header">
							<h3>알림</h3>
							<button id="markAllRead" class="btn-text">모두 읽음</button>
						</div>
						<div id="notiList" class="noti-list">
							<!-- 알림 항목이 여기에 동적으로 추가됨 -->
							<div class="noti-empty">알림이 없습니다.</div>
						</div>
						<div class="noti-footer">
							<a href="/my-page" class="btn-text">전체 보기</a>
						</div>
					</div>
				</div>
			</div>

			<!-- D-Day -->
			<div class="header-buttons">
				<div class="dday">
					<p>수능까지 </p>
					<span th:attr="data-dday=${dday}" th:text="${dday}"></span>
				</div>
			</div>

		</div>
	</div>
</header>

