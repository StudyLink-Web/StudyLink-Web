<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">

<div layout:fragment="content" class="container-md">
	<!-- ì œëª© -->
	<div class="successTitle">
		<h1>ğŸ‰ ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h1>
		<p>ì…ì‹œ ì¤€ë¹„ì— í•„ìš”í•œ ì—¬ëŸ¬ê°€ì§€ ê¸°ëŠ¥ì„ ì´ì œ ììœ ë¡­ê²Œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.</p>
	</div>

	<!-- êµ¬ë… ì •ë³´ -->
	<div class="successSection">
		<h2>êµ¬ë… ì •ë³´</h2>
		<ul class="info-list">
			<li>
				<strong>ìƒí’ˆëª…</strong>
				<span id="orderName"></span>
			</li>
			<li>
				<strong>êµ¬ë… ê¸°ê°„</strong>
				<span id="period"></span>
			</li>
			<li>
				<strong>ê²°ì œ ê¸ˆì•¡</strong>
				<span id="totalAmount"></span>
			</li>
			<li>
				<strong>ê²°ì œ ìˆ˜ë‹¨</strong>
				<span id="method"></span>
			</li>
			<li>
				<strong>ê²°ì œ ì¼ì‹œ</strong>
				<span id="approvedAt"></span>
			</li>
			<li>
				<strong>ì£¼ë¬¸ ë²ˆí˜¸</strong>
				<span id="orderId"></span>
			</li>
		</ul>

		<ul class="features" id="featureList">

		</ul>
	</div>

	<!-- ì•¡ì…˜ ë²„íŠ¼ -->
	<div class="successActions">
		<a href="/dashboard" class="btn-primary">ë‚´ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™</a>
		<a href="/chatbot" class="btn-secondary">AI ìƒë‹´ ë°”ë¡œ ì‹œì‘í•˜ê¸°</a>
	</div>

	<!-- ì•ˆë‚´ -->
	<div class="successSection">
		<h2>ì´ìš© ì•ˆë‚´</h2>
		<div class="successNotice">
			<p>Â· êµ¬ë… ê¸°ëŠ¥ì€ ê²°ì œ ì¦‰ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
			<p>Â· ê²°ì œ ë‚´ì—­ì€ <strong>ë§ˆì´í˜ì´ì§€ &gt; ê²°ì œ ê´€ë¦¬</strong>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
			<p>Â· ë¬¸ì˜ì‚¬í•­ì€ ê³ ê°ì„¼í„° ë˜ëŠ” 1:1 ë¬¸ì˜ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.</p>
		</div>
	</div>

	<script>
		// ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ê°’ì´ ê²°ì œ ìš”ì²­í•  ë•Œ ë³´ë‚¸ ë°ì´í„°ì™€ ë™ì¼í•œì§€ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”.
		// í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê²°ì œ ê¸ˆì•¡ì„ ì¡°ì‘í•˜ëŠ” í–‰ìœ„ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		const urlParams = new URLSearchParams(window.location.search);
		const paymentKey = urlParams.get("paymentKey");
		const orderId = urlParams.get("orderId");
		const amount = urlParams.get("amount");

		async function confirm() {
		    const requestData = {
				paymentKey: paymentKey,
				orderId: orderId,
				amount: amount,
		    };

		    const response = await fetch("/payment/confirm", {
				method: "POST",
				headers: {
			    	"Content-Type": "application/json",
				},
				body: JSON.stringify(requestData),
		    });

		    const json = await response.json();

		    if (!response.ok) {
				// ê²°ì œ ì‹¤íŒ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ì„¸ìš”.
				window.location.href = `/payment/fail`;
		    }

			// ê²°ì œì¼ íŒŒì‹±
			const approvedDate = new Date(json.approvedAt);

				// ì¢…ë£Œì¼ = ê²°ì œì¼ + 30ì¼
			const endDate = new Date(approvedDate);
			endDate.setDate(endDate.getDate() + 30);

			// ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (YYYY.MM.DD)
			function formatDate(date) {
				const y = date.getFullYear();
				const m = String(date.getMonth() + 1).padStart(2, '0');
				const d = String(date.getDate()).padStart(2, '0');
				return `${y}.${m}.${d}`;
			}

		    // ê²°ì œ ì„±ê³µ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ì„¸ìš”.
			const orderNameElement = document.getElementById("orderName");
			const periodElement = document.getElementById("period");
			const totalAmountElement = document.getElementById("totalAmount");
			const methodElement = document.getElementById("method");
			const approvedAtElement = document.getElementById("approvedAt");
			const orderIdElement = document.getElementById("orderId");
			const featureList = document.getElementById("featureList");

			orderNameElement.textContent = json.orderName;
			periodElement.textContent = `${formatDate(approvedDate)} ~ ${formatDate(endDate)}`;
			totalAmountElement.textContent = json.totalAmount + "ì›";
			methodElement.textContent = json.method;
			approvedAtElement.textContent = json.approvedAt;
			orderIdElement.textContent = json.orderId;
			const productId = json.productId;

			// ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
			featureList.innerHTML = "";

			if (productId === 1) {
				// ìƒí’ˆ 1 ê¸°ëŠ¥
				featureList.innerHTML = `
					<li>AI ìì†Œì„œ ë¶„ì„/ì²¨ì‚­ (ì›” 10íšŒ)</li>
					<li>AI ëŒ€ì… ìƒë‹´ ì±—ë´‡ (ì›” 30íšŒ)</li>
					<li>ëŒ€í•™ë³„ í•©ê²© ì˜ˆì¸¡ ë°ì´í„° ì¡°íšŒ</li>
					<li>ë§ì¶¤í˜• ì…ì‹œ ë¦¬í¬íŠ¸ ì œê³µ</li>
					<li>í”„ë¦¬ë¯¸ì—„ ê²Œì‹œíŒ ì ‘ê·¼ ê¶Œí•œ</li>
				`;
			} else if (productId === 2) {
				// ìƒí’ˆ 2 ê¸°ëŠ¥
				featureList.innerHTML = `
					<li>ì „ë…„ë„ í•©ê²©ì ìƒê¸°ë¶€ ì›ë³¸ ì—´ëŒ</li>
					<li>AI ìì†Œì„œ/ìƒë‹´/ë©´ì ‘ ë¬´ì œí•œ</li>
					<li>1:1 ì…ì‹œ ë©˜í† ë§ ìš°ì„  ë§¤ì¹­</li>
					<li>ì „ìš© Q&A ë¼ìš´ì§€ ì…ì¥ ê¶Œí•œ</li>
					<li>ì‹¤ì‹œê°„ ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ ìƒë‹´ ì—°ë™</li>
				`;
			} else {
				// ì˜ˆì™¸ ì²˜ë¦¬
				featureList.innerHTML = `
					<li>ì•Œ ìˆ˜ ì—†ëŠ” ìƒí’ˆì…ë‹ˆë‹¤.</li>
				`;
			}
		}
		confirm();


	</script>
</div>
