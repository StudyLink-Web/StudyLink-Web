<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">

<div layout:fragment="content" class="container-md">
	<div class="row">
		<!-- Sidebar -->
		<nav class="col-2 adminSidebar p-0">
			<h5 class="text-white text-center py-3 border-bottom">ADMIN</h5>
			<a th:href="@{/admin/admin}"
			   th:classappend="${currentMenu == 'admin'} ? 'active' : ''"
			   class="adminSidebarMenu">
				대시보드
			</a>
			<a th:href="@{/admin/user}"
			   th:classappend="${currentMenu == 'user'} ? 'active' : ''"
			   class="adminSidebarMenu">
				회원 관리
			</a>
			<a th:href="@{/admin/payment}"
			   th:classappend="${currentMenu == 'payment'} ? 'active' : ''"
			   class="adminSidebarMenu">
				결제 내역
			</a>
			<a th:href="@{/admin/exchange}"
			   th:classappend="${currentMenu == 'exchange'} ? 'active' : ''"
			   class="adminSidebarMenu">
				환전 관리
			</a>
			<a th:href="@{/admin/notice}"
			   th:classappend="${currentMenu == 'notice'} ? 'active' : ''"
			   class="adminSidebarMenu">알림 / 공지
			</a>
			<a th:href="@{/admin/inquiry}"
			   th:classappend="${currentMenu == 'inquiry'} ? 'active' : ''"
			   class="adminSidebarMenu">
				문의 내역
			</a>
		</nav>

		<!-- Main -->
		<main class="col-10 p-4">
			<!-- Page Title -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h4 class="fw-bold">회원 관리</h4>
			</div>

			<!-- Filter -->
			<div class="card mb-4 shadow-sm">
				<div class="card-body">
					<form method="get" class="row g-1 align-items-end" style="max-width: 1100px; margin:auto;">
						<!-- 이메일 검색 -->
						<div class="col-md-3">
							<label class="form-label">이메일</label>
							<input type="text" name="email" class="form-control" placeholder="회원 이메일" th:value="${email}">
						</div>

						<!-- 역할 검색 -->
						<div class="col-md-1">
							<select class="form-select" name="role">
								<option value="" th:selected="${role == null}">전체</option>
								<option value="MENTOR" th:selected="${role == 'MENTOR'}">멘토</option>
								<option value="STUDENT" th:selected="${role == 'STUDENT'}">학생</option>
							</select>
						</div>

						<!-- 상태 검색 -->
						<div class="col-md-1">
							<select class="form-select" name="isActive">
								<option value="" th:selected="${isActive == null}">전체</option>
								<option value="true" th:selected="${isActive == true}">활성</option>
								<option value="false" th:selected="${isActive == false}">비활성</option>
							</select>
						</div>

						<!-- 시작일 -->
						<div class="col-md-2">
							<label class="form-label">시작일</label>
							<input type="date" name="startDate" class="form-control" th:value="${startDate}">
						</div>

						<!-- 종료일 -->
						<div class="col-md-2">
							<label class="form-label">종료일</label>
							<input type="date" name="endDate" class="form-control" th:value="${endDate}">
						</div>

						<!-- 정렬 -->
						<div class="col-md-2">
							<label class="form-label">정렬</label>
							<select class="form-select" name="sort">
								<option value="desc" th:selected="${sort == null or sort == 'desc'}">최신순</option>
								<option value="asc" th:selected="${sort == 'asc'}">오래된순</option>
							</select>
						</div>

						<!-- 검색 버튼 -->
						<div class="col-md-1">
							<button type="submit" class="btn btn-dark w-100">
								검색
							</button>
						</div>
					</form>
				</div>
			</div>


			<!-- Payment Table -->
			<div class="card shadow-sm">
				<div class="card-header fw-bold text-center">
					회원 관리
				</div>

				<div class="card-body p-0">
					<table class="table table-hover mb-0">
						<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>이메일</th>
							<th>이름</th>
							<th>역할</th>
							<th>상태</th>
							<th>가입일</th>
							<th class="text-center">관리</th>
						</tr>
						</thead>

						<tbody>
						<tr th:each="user : ${usersList}">
							<!-- ID -->
							<td th:text="${user.userId}">1</td>

							<!-- 이메일 -->
							<td th:text="${user.email}">email@test.com</td>

							<!-- 이름 -->
							<td th:text="${user.name}">홍길동</td>

							<!-- 역할 -->
							<td>
								<span class="badge bg-info text-dark"
									  th:text="${user.role}">
								ADMIN
								</span>
							</td>

							<!-- 상태 -->
							<td>
								<span th:if="${user.isActive}" class="badge bg-success">활성</span>
								<span th:unless="${user.isActive}" class="badge bg-secondary">비활성</span>
							</td>

							<!-- 가입일 -->
							<td th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd')}">
								2026-01-26
							</td>

							<!-- 관리 -->
							<td class="text-center">
								<a th:href="@{/admin/user/{id}(id=${user.userId})}"
								   class="btn btn-sm btn-outline-secondary">
									상세
								</a>
							</td>
						</tr>

						<!-- 데이터 없을 때 -->
						<tr th:if="${#lists.isEmpty(usersList)}">
							<td colspan="7" class="text-center py-4 text-muted">
								회원 정보가 없습니다.
							</td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>


			<!-- Pagination -->
			<nav class="mt-4" th:if="${page.totalPages > 1}">
				<ul class="pagination justify-content-center">
					<!-- 이전 -->
					<li class="page-item"
						th:classappend="${page.first} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/users(
							page=${page.number - 1},
							role=${role},
							isActive=${isActive},
							email=${email},
							sort=${sort}
							)}">
							이전
						</a>
					</li>


					<!-- 페이지 번호 -->
					<li class="page-item"
						th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
						th:classappend="${i == page.number} ? 'active'">
						<a class="page-link"
						    th:text="${i + 1}"
						    th:href="@{/admin/users(
							page=${i},
							role=${role},
							isActive=${isActive},
							email=${email},
							sort=${sort}
							)}">
						</a>
					</li>


					<!-- 다음 -->
					<li class="page-item"
						th:classappend="${page.last} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/users(
							page=${page.number + 1},
							role=${role},
							isActive=${isActive},
							email=${email},
							sort=${sort}
							)}">
							다음
						</a>
					</li>
				</ul>
			</nav>
		</main>
	</div>
</div>
