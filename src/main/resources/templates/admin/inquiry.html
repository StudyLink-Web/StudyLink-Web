<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">

<div layout:fragment="content" class="container-md">
	<div class="row">
		<!-- Sidebar -->
		<nav class="col-2 adminSidebar p-0">
			<h5 class="text-white text-center py-3 border-bottom">ADMIN</h5>
			<a th:href="@{/admin/admin}"
			   th:classappend="${currentMenu == 'admin'} ? 'active' : ''"
			   class="adminSidebarMenu">
				대시보드
			</a>
			<a th:href="@{/admin/user}"
			   th:classappend="${currentMenu == 'user'} ? 'active' : ''"
			   class="adminSidebarMenu">
				회원 관리
			</a>
			<a th:href="@{/admin/payment}"
			   th:classappend="${currentMenu == 'payment'} ? 'active' : ''"
			   class="adminSidebarMenu">
				결제 내역
			</a>
			<a th:href="@{/admin/exchange}"
			   th:classappend="${currentMenu == 'exchange'} ? 'active' : ''"
			   class="adminSidebarMenu">
				환전 관리
			</a>
			<a th:href="@{/admin/notice}"
			   th:classappend="${currentMenu == 'notice'} ? 'active' : ''"
			   class="adminSidebarMenu">알림 / 공지
			</a>
			<a th:href="@{/admin/inquiry}"
			   th:classappend="${currentMenu == 'inquiry'} ? 'active' : ''"
			   class="adminSidebarMenu">
				문의 내역
			</a>
		</nav>

		<!-- Main -->
		<main class="col-10 p-4">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h4 class="fw-bold">문의 내역</h4>
			</div>

			<!-- 검색 -->
			<div class="card mb-4 shadow-sm">
				<div class="card-body">
					<form method="get" th:action="@{/admin/inquiry}" class="row g-1 align-items-end" style="max-width: 1100px; margin:auto;">
						<div class="col-md-1">
							<label class="form-label">카테고리</label>
							<select class="form-select" name="choose">
								<option value="" th:selected="${choose == null}">전체</option>
								<option value="계정" th:selected='${choose == "계정"}'>계정</option>
								<option value="결제" th:selected='${choose == "결제"}'>결제</option>
								<option value="기능" th:selected='${choose == "기능"}'>기능</option>
								<option value="오류" th:selected='${choose == "오류"}'>오류</option>
								<option value="기타" th:selected='${choose == "기타"}'>기타</option>
							</select>
						</div>

						<div class="col-md-2">
							<label class="form-label">문의 상태</label>
							<select class="form-select" name="status">
								<option value="" th:selected="${status == null}">전체</option>
								<option value="PENDING" th:selected='${status == "PENDING"}'>접수 완료</option>
								<option value="READY" th:selected='${status == "READY"}'>답변 중</option>
								<option value="COMPLETE" th:selected='${status == "COMPLETE"}'>답변 완료</option>
							</select>
						</div>

						<div class="col-md-2">
							<label class="form-label">회원명</label>
							<input type="text" name="username" class="form-control" th:value="${username}">
						</div>

						<div class="col-md-2">
							<label class="form-label">시작일</label>
							<input type="date" name="startDate" class="form-control" th:value="${startDate}">
						</div>

						<div class="col-md-2">
							<label class="form-label">종료일</label>
							<input type="date" name="endDate" class="form-control" th:value="${endDate}">
						</div>

						<div class="col-md-2">
							<label class="form-label">정렬</label>
							<select name="sort" class="form-select">
								<option value="desc" th:selected="${sort == 'desc'}">최신순</option>
								<option value="asc" th:selected="${sort == 'asc'}">오래된순</option>
							</select>
						</div>

						<div class="col-md-1 d-grid">
							<button class="btn btn-primary">검색</button>
						</div>
					</form>
				</div>
			</div>

			<!-- 테이블 -->
			<div class="card shadow-sm">
				<div class="card-header fw-bold text-center">
					문의 내역
				</div>

				<div class="card-body p-0">
					<table class="table table-hover mb-0">
						<thead class="table-light text-center">
						<tr>
							<th>ID</th>
							<th>회원</th>
							<th>카테고리</th>
							<th>공개여부</th>
							<th>상태</th>
							<th>등록일</th>
							<th class="text-center">상세</th>
						</tr>
						</thead>

						<tbody>
						<tr th:each="inquiry : ${adminInquiryDTOList}" class="text-center">
							<td th:text="${inquiry.inquiryDTO.qno}">1</td>
							<td th:text="${inquiry.usersDTO != null ? inquiry.usersDTO.username : ''}">유저명</td>
							<td th:text="${inquiry.inquiryDTO.choose}">카테고리</td>

							<td>
								<span th:if="${inquiry.inquiryDTO.isPublic}" class="badge bg-success">공개</span>
								<span th:unless="${inquiry.inquiryDTO.isPublic}" class="badge bg-secondary">비공개</span>
							</td>

							<td>
					<span th:switch="${inquiry.inquiryDTO.status}">
						<span th:case="PENDING"
							  class="badge bg-warning">접수 완료</span>
						<span th:case="READY"
							  class="badge bg-success">답변 중</span>
						<span th:case="COMPLETE"
							  class="badge bg-secondary">답변 완료</span>
					</span>
							</td>

							<td th:text="${inquiry.inquiryDTO.createdAt != null
								? #temporals.format(inquiry.inquiryDTO.createdAt, 'yyyy-MM-dd HH:mm')
								: '-'}">
								-
							</td>

							<td class="text-center">
								<a th:href="@{/admin/inquiry/{id}(id=${inquiry.inquiryDTO.qno})}"
								   class="btn btn-sm btn-outline-secondary">
									상세
								</a>
							</td>
						</tr>

						<tr th:if="${#lists.isEmpty(adminInquiryDTOList)}">
							<td colspan="7" class="text-center py-4 text-muted">
								문의 내역이 없습니다.
							</td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>

			<nav class="mt-4" th:if="${page.totalPages > 1}">
				<ul class="pagination justify-content-center">

					<li class="page-item" th:classappend="${page.first} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/inquiry(
							page=${page.number - 1},
							choose=${choose},
							status=${status},
							username=${username},
							startDate=${startDate},
							endDate=${endDate}
							)}">
							이전
						</a>
					</li>

					<li class="page-item"
						th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
						th:classappend="${i == page.number} ? 'active'">

						<a class="page-link"
						    th:text="${i + 1}"
						    th:href="@{/admin/inquiry(
							page=${i},
							choose=${choose},
							status=${status},
							username=${username},
							startDate=${startDate},
							endDate=${endDate}
							)}">
						</a>
					</li>

					<li class="page-item" th:classappend="${page.last} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/inquiry(
							page=${page.number + 1},
							choose=${choose},
							status=${status},
							username=${username},
							startDate=${startDate},
							endDate=${endDate}
							)}">
							다음
						</a>
					</li>

				</ul>
			</nav>
		</main>
	</div>
</div>
