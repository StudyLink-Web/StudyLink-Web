<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">

<div layout:fragment="content" class="container-md">
	<div class="row">
		<!-- Sidebar -->
		<nav class="col-2 adminSidebar p-0">
			<h5 class="text-white text-center py-3 border-bottom">ADMIN</h5>
			<a th:href="@{/admin/admin}"
			   th:classappend="${currentMenu == 'admin'} ? 'active' : ''"
			   class="adminSidebarMenu">
				대시보드
			</a>
			<a th:href="@{/admin/user}"
			   th:classappend="${currentMenu == 'user'} ? 'active' : ''"
			   class="adminSidebarMenu">
				회원 관리
			</a>
			<a th:href="@{/admin/payment}"
			   th:classappend="${currentMenu == 'payment'} ? 'active' : ''"
			   class="adminSidebarMenu">
				결제 내역
			</a>
			<a th:href="@{/admin/exchange}"
			   th:classappend="${currentMenu == 'exchange'} ? 'active' : ''"
			   class="adminSidebarMenu">
				환전 관리
			</a>
			<a th:href="@{/admin/notice}"
			   th:classappend="${currentMenu == 'notice'} ? 'active' : ''"
			   class="adminSidebarMenu">알림 / 공지
			</a>
			<a th:href="@{/admin/inquiry}"
			   th:classappend="${currentMenu == 'inquiry'} ? 'active' : ''"
			   class="adminSidebarMenu">
				문의 내역
			</a>
		</nav>

		<!-- Main -->
		<main class="col-10 p-4">
			<!-- Page Title -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h4 class="fw-bold">결제 내역 관리</h4>
			</div>

			<!-- Filter -->
			<div class="card mb-4 shadow-sm">
				<div class="card-body">
					<form method="get" class="row g-1 align-items-end" style="max-width: 1100px; margin:auto;">
						<!-- 결제 상태 -->
						<div class="col-md-1">
							<label class="form-label">결제 상태</label>
							<select class="form-select" name="status">
								<option value="" th:selected="${status == null}">전체</option>
								<option th:each="stat : ${statuses}"
										th:value="${stat.name()}"
										th:text="${stat.displayName}"
										th:selected="${stat == status}">
								</option>
							</select>
						</div>


						<!-- 결제 수단 -->
						<div class="col-md-1">
							<label class="form-label">결제 수단</label>
							<select class="form-select" name="method">
								<option value="" th:selected="${method == null or method == ''}">전체</option>
								<option value="카드" th:selected="${method == 'CARD'}">카드</option>
								<option value="간편결제" th:selected="${method == 'EASY_PAY'}">간편결제</option>
								<option value="계좌이체" th:selected="${method == 'TRANSFER'}">계좌이체</option>
							</select>
						</div>


						<!-- 이메일 검색 -->
						<div class="col-md-3">
							<label class="form-label">이메일</label>
							<input type="text" name="email" class="form-control" placeholder="회원 이메일" th:value="${email}">
						</div>


						<!-- 시작일 -->
						<div class="col-md-2">
							<label class="form-label">시작일</label>
							<input type="date" name="startDate" class="form-control" th:value="${startDate}">
						</div>


						<!-- 종료일 -->
						<div class="col-md-2">
							<label class="form-label">종료일</label>
							<input type="date" name="endDate" class="form-control" th:value="${endDate}">
						</div>


						<!-- 정렬 -->
						<div class="col-md-2">
							<label class="form-label">정렬</label>
							<select class="form-select" name="sort">
								<option value="desc" th:selected="${sort == null or sort == 'desc'}">최신순</option>
								<option value="asc" th:selected="${sort == 'asc'}">오래된순</option>
							</select>
						</div>


						<!-- 검색 버튼 -->
						<div class="col-md-1">
							<button type="submit" class="btn btn-primary w-100">
								검색
							</button>
						</div>
					</form>
				</div>
			</div>


			<!-- Payment Table -->
			<div class="card shadow-sm">
				<div class="card-header fw-bold text-center">
					결제 내역
				</div>

				<div class="card-body p-0">
					<table class="table table-hover mb-0">
						<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>결제 번호</th>
							<th>회원</th>
							<th>상품</th>
							<th>금액</th>
							<th>결제 수단</th>
							<th>상태</th>
							<th>승인일</th>
							<th class="text-center">관리</th>
						</tr>
						</thead>

						<tbody>
						<tr th:each="adminPayment : ${adminPaymentDTOList}">
							<td th:text="${adminPayment.paymentDTO.paymentId}">1</td>
							<td th:text="${adminPayment.paymentDTO.orderId}">ORDER-XXXX</td>

							<!-- 회원 이메일 -->
							<td th:text="${adminPayment.email}">email@test.com</td>

							<!-- 상품명 (예시는 productId 기준) -->
							<td th:text="${adminPayment.productName}"></td>

							<!-- 금액 -->
							<td th:text="|₩${#numbers.formatInteger(adminPayment.paymentDTO.amount, 3, 'COMMA')}|">
								₩300,000
							</td>

							<!-- 결제 수단 -->
							<td th:text="${adminPayment.paymentDTO.method}">CARD</td>

							<!-- 상태 -->
							<td>
								<span th:switch="${adminPayment.paymentDTO.status}">
								<span th:case="${T(com.StudyLink.www.entity.PaymentStatus).PENDING}"
									  class="badge bg-warning">대기</span>
								<span th:case="${T(com.StudyLink.www.entity.PaymentStatus).APPROVED}"
									  class="badge bg-success">결제 완료</span>
								<span th:case="${T(com.StudyLink.www.entity.PaymentStatus).CANCELED}"
									  class="badge bg-danger">결제 취소</span>
								<span th:case="${T(com.StudyLink.www.entity.PaymentStatus).FAILED}"
									  class="badge bg-secondary">결제 실패</span>
								</span>
							</td>

							<!-- 승인일 -->
							<td th:text="${#temporals.format(adminPayment.paymentDTO.approvedAt, 'yyyy-MM-dd HH:mm')}">
								2026-01-26 14:22
							</td>

							<!-- 관리 -->
							<td class="text-center">
								<a th:href="@{/admin/payment/{id}(id=${adminPayment.paymentDTO.paymentId})}"
								    class="btn btn-sm btn-outline-secondary">
									상세
								</a>
							</td>
						</tr>

						<!-- 데이터 없을 때 -->
						<tr th:if="${#lists.isEmpty(adminPaymentDTOList)}">
							<td colspan="9" class="text-center py-4 text-muted">
								결제 내역이 없습니다.
							</td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>


			<!-- Pagination -->
			<nav class="mt-4" th:if="${page.totalPages > 1}">
				<ul class="pagination justify-content-center">

					<!-- 이전 -->
					<li class="page-item"
						th:classappend="${page.first} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/payment(
							page=${page.number - 1},
							status=${status},
							method=${method},
							email=${email},
							startDate=${startDate},
							endDate=${endDate},
							sort=${sort}
							)}">
							이전
						</a>
					</li>

					<!-- 페이지 번호 -->
					<li class="page-item"
						th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
						th:classappend="${i == page.number} ? 'active'">
						<a class="page-link"
						    th:text="${i + 1}"
						    th:href="@{/admin/payment(
							page=${i},
							status=${status},
							method=${method},
							email=${email},
							startDate=${startDate},
							endDate=${endDate},
							sort=${sort}
							)}">
						</a>
					</li>

					<!-- 다음 -->
					<li class="page-item"
						th:classappend="${page.last} ? 'disabled'">
						<a class="page-link"
						    th:href="@{/admin/payment(
							page=${page.number + 1},
							status=${status},
							method=${method},
							email=${email},
							startDate=${startDate},
							endDate=${endDate},
							sort=${sort}
							)}">
							다음
						</a>
					</li>
				</ul>
			</nav>
		</main>
	</div>
</div>
